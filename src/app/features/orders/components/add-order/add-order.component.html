<form [formGroup]="ordenForm" (ngSubmit)="agregarOrden()">
  <!-- Control para seleccionar cliente -->
  <div class="mb-4">
    <label for="cliente" class="block text-sm font-medium text-gray-700">Cliente</label>
    <ng-select
      class="mt-1 block w-full px-3 py-2 border border-sky-500 rounded-md shadow-sm focus:outline-none"
      id="cliente"
      formControlName="cliente"
      [items]="clients"
      bindLabel="nombreCompleto"
      (search)="buscar($event.term)" 
      placeholder="Seleccione un cliente"
      [loading]="loading"
    >
    </ng-select>
  </div>

  <!-- Control para descripción -->
  <div class="mb-4">
    <label for="descripcion" class="block text-sm font-medium text-gray-700">Descripción</label>
    <input
      id="descripcion"
      type="text"
      formControlName="descripcion"
      class="mt-1 block w-full px-3 py-2 border border-sky-500 rounded-md shadow-sm focus:outline-none"
    />
    <div *ngIf="ordenForm.get('descripcion')?.invalid && ordenForm.get('descripcion')?.touched" class="text-red-500 text-sm">
      La descripción es obligatoria.
    </div>
  </div>

  <!-- Tabla de ítems -->
  <div class="mb-4">
    <h2 class="text-lg font-semibold">Ítems</h2>
    <table class="min-w-full border-collapse border border-gray-300">
      <thead>
        <tr>
          <th class="border border-gray-300 px-4 py-2">Descripción</th>
          <th class="border border-gray-300 px-4 py-2">Cantidad</th>
          <th class="border border-gray-300 px-4 py-2">Precio</th>
          <th class="border border-gray-300 px-4 py-2">Subtotal</th>
          <th class="border border-gray-300 px-4 py-2">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of itemsControls; let i = index" [formGroup]="item">
          <td class="border border-gray-300 px-4 py-2">
            <input type="text" formControlName="descripcion" class="w-full" />
          </td>
          <td class="border border-gray-300 px-4 py-2">
            <input type="number" formControlName="cantidad" class="w-full" />
          </td>
          <td class="border border-gray-300 px-4 py-2">
            <input type="number" formControlName="precio" class="w-full" />
          </td>
          <td class="border border-gray-300 px-4 py-2">
            {{ calcularSubtotal(item) | currency }}
          </td>
          <td class="border border-gray-300 px-4 py-2">
            <button type="button" (click)="eliminarItem(i)" class="text-red-500">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Botón para agregar ítem -->
  <div class="flex justify-between mb-4">
    <button type="button" (click)="agregarItem()" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded">
      Agregar Ítem
    </button>
  </div>

  <!-- Total -->
  <div class="mb-4">
    <p class="text-lg font-semibold">Total: {{ total | currency }}</p>
  </div>

  <!-- Botón para enviar la orden -->
  <div class="flex justify-center">
    <button type="submit" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded">
      Agregar Orden de Pedido
    </button>
  </div>
</form>
